# Виды тестов

## Тесты в репозитории pelican-ui

### 1. Линтинг типов 

Линтинг типов (статический вид тестирования), типы генерируются с помощью библиотеки swagger-typescript-api на основе swagger CMS.
Эти типы используются для переменных с ответом API, что позволяет дополнительно обеспечить корректность контракта между CMS и Frontend'ом.

#### Что проверяют?
Проверяют контракт между CMS и Frontend'ом, посредством линтинга typescript'а. А именно тип ответа API.

#### Когда пишутся тесты на линтинг?
Пишутся когда в репозитории Frontend'а добавляются запросы.
Пример для запроса страницы документов, константе присваивается тип *DocumentsPageResponse*, полученный с помощью swagger-typescript-api.

```js
  const documentsPageResponse: DocumentsPageResponse = await api.get(`/documents-page?populate=*`);
```

### 2. Скриншотные тесты (TDD)
Скриншотные тесты на playwright. Позволяют проверять соответствия дизайна и верстки.
Процесс верстки через TDD описан [тут](../architecture%20decision%20records/Процесс%20верстки%20через%20TDD.md)

#### Что проверяют?
Проверяют визуальную составляющую сайта на тестовых данных, посредством pixel perfect сравнения.

#### Когда пишутся скриншотные тесты?
Пишутся по TDD, до верстки каких-либо блоков. Пример написания можно посмотреть [тут](https://github.com/TourmalineCore/pelican-ui/blob/master/src/components/home-page/HomepageHero/HomepageHero.spec.tsx)

### 3. Тесты на поведение (TDD)

#### Что проверяют?
Проверяют функциональность интерактивных компонентов на сайте (например аккордеон, попап).

#### Когда пишутся тесты на поведение?
Пишутся по TDD, до реализации функциональности компонентов. Находятся в том же файле, что и скриншотные тесты, но в отдельном тесте (actionTest). Пример написания можно посмотреть [тут](https://github.com/TourmalineCore/pelican-ui/blob/master/src/components/globals/Header/components/HeaderPopup/HeaderPopup.spec.tsx)

### 4. Тестирование доступности (E2E)
Тестирование доступности (E2E). Проверяют, что наши страницы сайта соответствуют критериям доступности. 
Имеются вручную написанные тесты с помощью Playwright, которые проверяют:
  - 1. Правильный путь навигации с помощью Tab'ов
  - 2. Наличие фокуса на элементе
  - 3. Наличие aria-label в элементах без текста (например крестик закрытия попапа)

#### Что проверяют?
Проверяют сайт по критериям доступности.
 
#### Когда пишутся Playwright тесты на доступность?
Пишутся после того как сверстан блок и в блоке присутствуют интерактивные элементы (кнопки, ссылки). Примеры [тут](https://github.com/TourmalineCore/pelican-ui/blob/master/playwright-tests/e2e/FocusIndicatorTest.spec.tsx)

Также имеются тесты, внутри которых используется инструмент [axe-core](https://www.npmjs.com/package/axe-core), который анализирует страницы сайта на соответствие критериям доступности.

#### Когда пишутся тесты c axe-core?
Пишутся после того как сверстана страница. Примеры [тут](https://github.com/TourmalineCore/pelican-ui/blob/master/playwright-tests/axe-tests/axeCheckUpHomePage.spec.tsx)

### 5. Полноценные E2E тесты
Есть несколько типов:
1. Тесты, которые проверяют интеграцию CMS с Frontend'ом. Проверяется, что после добавления данных через CMS они успешно отображаются на UI. 

ВАЖНО! В данном виде тестирования нет цели проверить все поля из CMS, достаточно 2-3 полей.

2. Превью тесты, проверяют функционал просмотра чернового варианта сайта.

#### Что проверяют?
Проверяют взаимодействия CMS и Frontend'а и заодно все модули системы (базу данных, s3). Заполнение данных CMS выполняется через API.

#### Когда пишутся E2E?
1. E2E тесты пишутся после того, как интеграция CMS и Frontend'а закончена (например добавлена коллекция новостей или новый блок на страницу) Примеры можно посмотреть [тут](https://github.com/TourmalineCore/pelican-ui/blob/master/playwright-tests/e2e/cms-integration/integration/contact-zoo-page.spec.ts).


## Тесты в репозитории pelican-cms
### 1. API тесты на playwright

#### Что проверяют?
Проверяют, что в ответах API присутствуют все необходимые поля (соответствие контракту). Примеры можно посмотреть [тут](https://github.com/TourmalineCore/pelican-cms/tree/master/playwright-tests/api-tests)

#### Когда пишутся API тесты? 
Пишутся когда в CMS добавляются новые коллекции или страницы. Также необходимо обновлять тесты, если в существующие коллекции или страницы добавляются/удаляются поля. 