# TC Zoo Test Cases & Test Plan

## Тест-кейсы:

1. **Хедер.** Кликнуть “Услуги” в хедере - пользователь попал на раздел “Наши услуги” с вертикальным скроллом.

2. **Хедер.** Кликнуть “Адрес” в хедере - пользователь попал на раздел адреса с картой с вертикальным скроллом.

3. **Хедер.** Кликнуть “Правила посещения” в хедере - пользователь переходит на страницу правил посещения.

4. **Хедер.** Кликнуть “Льготы” в хедере - пользователь переходит на страницу “Льготы” (или возможно переход на документ со всеми льготами в новой вкладке браузера в рамках 1-го релиза/мгновенная скачка документа со всеми льготами).

5. **Хедер.** Кликнуть “Документация” в хедере - пользователь переходит на страницу документации.

6. **Хедер.** Кликнуть на “Глазок” - включилась версия для слабовидящих.

7. **Хедер.** Кликнуть на “Глазок” обратно - включилась версия для нормально видящих.

8. **Хедер.** Кликнуть на “Связаться” - пользователь переместился в футер.

9. **Хедер.** Кликнуть на “Билеты” - откроется меню доступных билетов.

   9.1. Кликнуть на любой билет, кроме “Льготный” - откроется виджет афиши Яндекса.

   9.2. Попробовать кликнуть на “Льготный” - не должен произойти переход в Яндекс виджет (как проверить? подумать).

       9.2.1. Кликнуть на “Льготный - Подробнее” - открылась информация о категориях льготников с прайс-листом.

       9.2.1.1. Кликнуть на “Льготный - Подробнее - Остальные льготные категории” - пользователь переходит на страницу “Льготы” (или возможно переход на документ со всеми льготами в новой вкладке браузера в рамках 1-го релиза/мгновенная скачка документа со всеми льготами).

   9.3. Кликнуть на “Правила посещения” - открылся аккордеон с правилами посещения.

       9.3.1. Кликнуть на “Подробнее о правилах посещения” - пользователь переходит на страницу “Правила посещения” (или возможно переход на документ со всеми правилами посещения в новой вкладке браузера в рамках 1-го релиза/мгновенная скачка документа со всеми правилами посещения).

   9.4. Кликнуть на “Возврат билетов” - открылся аккордеон с возможными случаями для возврата билетов.

       9.4.1. Кликнуть на “Подробнее о возврате билетов” - открылся подробный документ с возможными случаями для возврата билетов.

10. Закрыть поп-ап с покупкой билетов.

11. **Виды животных.** Убедиться, что видео в разделе “о видах животных” корректно воспроизводится автоплеем с бесконечным циклом (визуально легко проверяется вручную, подумать можно ли / надо ли автоматизировать).

12. **Наши услуги.** Кликнуть “Уточнить вопросы можно по телефону” с мобилки - открылось окно “Телефон” с набранным номером из элемента сайта с номером телефона (скорее вручную, подумать можно ли автоматизировать).

13. **Наши услуги.** Кликнуть “Запись осуществляется по почте” с мобилки - открылось окно “Почта” с указанным адресатом из элемента сайта с почтой зоопарка (скорее вручную, подумать можно ли автоматизировать).

14. **Наши услуги.** Горизонтальный скролл. Проскроллить до конца вправо - последние элементы - номер и почта зоопарка.

15. **Наши услуги.** Горизонтальный скролл. Проскроллить до конца влево - первый элемент “Экскурсии” (подумать над тем, как убедиться, что ты на левой / правой границе независимо от контента элемента).

16. **Входные билеты.** Повторить тест-кейсы пункта покупки билетов.

17. **Льготные билеты.** Кликнуть на “по ссылке” - открылись остальные льготные категории.

18. **Местоположение.** Кликнуть на “остановка ‘Зоопарк’” - проверить, что мы отправляем запросом в Яндекс Карты правильный субъект (зоопарк). Подумать над этой проверкой. (возможно впихнуть как часть определенного Е2Е сценария - разом проверить что клик триггерит исходящий запрос с правильным параметром на Яндекс).

19. **Футер. О зоопарке.** Кликнуть “Новости” - открылась страница с новостями зоопарка.

20. **Футер. О зоопарке.** Кликнуть “Документы” - открылась страница с документами зоопарка.

21. **Футер. О зоопарке.** Кликнуть “Правила посещения” - открылась страница с правилами посещения зоопарка.

22. **Футер. О зоопарке.** Кликнуть “Оставить отзыв” - открылось форма в новой вкладке с оставлением отзыва о зоопарке.

23. **Футер. Посетителям.** Кликнуть “Услуги” - перенаправление на раздел “Наши услуги”. (скролл).

24. **Футер. Посетителям.** Кликнуть “Билеты” - открывается поп-ап с билетами.

25. **Футер. Посетителям.** Кликнуть “Льготы” - пользователь переходит на страницу “Льготы” (или возможно переход на документ со всеми льготами в новой вкладке браузера в рамках 1-го релиза/мгновенная скачка документа со всеми льготами).

26. **Футер.** Кликнуть номер телефона с мобилки - открылось окно “Телефон” с набранным номером из элемента сайта с номером телефона.

27. **Футер.** Кликнуть почту с мобилки - открылось окно “Почта” с указанным адресатом из элемента сайта с почтой зоопарка.

28. **Футер. Контакты.** Кликнуть “Tourmaline Core” - в новой вкладке открылся сайт [tourmalinecore.com](https://tourmalinecore.com).

29. **Футер. Контакты.** Кликнуть иконку “ВК” - в новой вкладке открылась страница ВК зоопарка.

30. **Футер. Контакты.** Кликнуть иконку “ТГ” - в новой вкладке открылся телеграм-канал зоопарка.

31. **Футер. Контакты.** Кликнуть иконку “Одноклассники” - в новой вкладке открылся паблик Зоопарка в Одноклассниках.

32. **Футер. Контакты.** Кликнуть иконку “Яндекс. Дзен” - в новой вкладке открылся Дзен Зоопарка со статьями.

33. **Футер.** Кликнуть “Управление культуры администрации г. Челябинска” - в новой вкладке откроется сайт [kultura74.ru](https://kultura74.ru).

34. **Футер.** Кликнуть “Министерство культуры Челябинской области” - в новой вкладке откроется сайт [mincult.gov74.ru](https://mincult.gov74.ru).

35. **Футер.** Кликнуть “Администрация г. Челябинска” - в новой вкладке откроется сайт [cheladmin.ru](https://cheladmin.ru).

36. **Страница Льгот.** “Дети от 5 до 13 лет” - Кликнуть “Закон РФ от 09.10.1992 года № 3612-1”.

37. **Страница Льгот.** Кликнуть на “Приказом №188 от 19.06.2020 г. 'Об установлении категорий граждан без оплаты входных билетов МБУК 'Зоопарк' (с изм. №1 от 31.08.2021 г.)”.

38. **Страница Документации.** Дата. Выбрать год.

39. **Страница Документации.** Кликнуть “Скачать документ”.

40. **Страница Документации.** Развернуть документ.

41. **Страница Документации.** Кликнуть “Скачать поддокумент” внутри развернутого документа.

42. **Страница Документации.** Свернуть документ.

43. **Страница Документации.** Развернуть все документы - все документы развернуты и верстка страницы не сломалась.

44. **Страница Новостей.** Кликнуть на новость - переход на страницу с новостью.

45. **Страница Новости. Читайте также.** Кликнуть “горизонтальный скролл вправо”.

46. **Страница Новости. Читайте также.** Кликнуть “горизонтальный скролл влево”.

47. **Страница Новости. Читайте также.** Попробовать кликнуть “горизонтальный скролл влево”, находясь на максимально левой границе слайдера - кнопка неактивна.

48. **Страница Новости. Читайте также.** Попробовать кликнуть “горизонтальный скролл вправо”, находясь на максимально правой границе слайдера - кнопка неактивна.

---

## Вопросы и предложения по функциональному тестированию:

- Тестируем через TDD? В рамках E2E / компонентных тестов?
- Открытие-закрытие попапа с графиком работы.
- Открытие-закрытие меню (клик по бургеру).
- Переход на меню с билетами.
- Работа аккордеонов внутри меню с билетами.
- Наведение на карточки-ссылки, которые меняют цвет (раздел билеты), наведение на ссылки.
- Клик на “остановка ‘Зоопарк’” и переход на Яндекс карты.

## Приоритеты тестирования (1-ая версия Тест-плана):

### Шаги тестирования:

#### ***1. Пиксель перфект (скриншотные) тесты: в рамках E2E-тестов.***
Описание процесса: 
   - Подтягиваем скриншот из фигмы 
   - тест падает, верстаем до тех пор, пока тест не пройдет
   - продолжаем верстать до допустимой сходимости по скрину из фигмы
   - потом меняем скрин из фигмы на наш собственный скриншот актуальной верстки и берем его за эталон, а дальше сравниваем всегда с ним по пиксельперфект.
      
Тип тестирования: 
- Автоматизированные визуальные тесты.
- Верстка через screen тесты.

***Инструкции и регламент по данному виду тестирования:***
1. Необходимо работать над проектом через dev container.
2. Определенное именование файлов для картинок из фигмы.
   - Пример:
     - `header-desktop-chromium-linux`
     - `header-desktop-firefox-linux`
3. При верстке по картинке из фигмы допустимое значение параметра `maxDiffPixelRatio` 0.02-0.03.
4. После того как тест начинает проходить, удаляем картинку из фигмы и убираем параметр `maxDiffPixelRatio`.
5. Запускаем тест, он сделает скрин и упадет, повторно запускаем его и видим, что он успешно проходит.

---
Другие возможные варианты и текущий вариант (выделенный): 
***1. Либо проверка всех компонентов в совокупности визуально в E2E с помощью Playwright.***
2. Либо проверка компонентов отдельно с помощью Playwright (если получится победить компонентные тесты) + в E2E проверить их в совокупности на Playwright.
3. Либо проверка компонентов отдельно с помощью Cypress + в совокупности в E2E на Playwright (нагрузка на поднятие сайта).
4. Либо проверка компонентов отдельно с помощью Cypress + E2E на Cypress.

---

#### ***2. Проверка поведения компонентов (в E2E “секционных” тестах) - поведение скриншотами пока не проверяем.***
#### ***3.  Проверка Accessibility в E2E (доступность для всех категорий пользователей, чтобы все элементы интерфейса табались и можно было пользоваться сайтом без мыши).***
#### ***4. Маршрутизация по сайту и покупка билетов.***
Тип тестирования: E2E (Playwright)

**Как проверяется:**

E2E тест:  
Тестирование полной навигации, где проверяется переход между всеми ключевыми страницами. Например, сценарий, который начинается с главной страницы и последовательно проверяет все ссылки.

Полный сценарий пользователя прохождения по страницам сайта (ознакомление с информацией в хронологическом порядке и покупки билета (услуги - документация - правила посещения - льготы - взаимодействие с адресом и соц. сетями в футере - покупка билета), включающий выбор билета, проверка корректности параметров, отправляемых на сторонний API в виде виджета Яндекса и проверка редиректа на виджет Яндекса. Это позволит оценить рабочий процесс с точки зрения пользователя и проверит роутинг всех страниц.

Так как преимущественно пользователю предстоит работать лишь с просмотром информации - возможно, можно будет подключить визуальное (скриншотное тестирование) на каждой странице, чтобы удостовериться в корректной отрисовке компонентов страницы (Playwright).

---

Компонентные тесты:

- Тестирование отдельных компонентов (например, отрисовка билета, кнопка "Купить билет") для проверки их правильного функционирования в изоляции. (но это пока возможно в Cypress, пока не разобрались с Playwright).

#### ***5. Проверка пользовательского опыта (UX) и юзабилити:***

- **Тип тестирования:** Ручное тестирование.

**Как проверяется:**

E2E тест: Провести краткий анализ для оценки взаимодействия с сайтом в целом, вызывая различные компоненты и проверяя, насколько интуитивно понятен пользовательский опыт.

---

#### ***6. Нагрузочное тестирование:***

**Тип тестирования:** E2E.

**Как проверяется:**

E2E тест: Имитация пользовательского поведения под нагрузкой для тестирования производительности, учета времени отклика и обработки запросов. Это позволит оценить, как система справляется с высокой нагрузкой, симулируя реальные сценарии использования (спросить у зоопарка, сколько пользователей в среднем находится на сайте и покупает билеты).


# Протокол тестирования доступности: 

## Используя Playwright:

1) Пишем сами тесты на каждый (если это возможно в случае конкретного элемента) элемент в рамках доступности на предмет:
    - **проверки tab`ов** \
**Примеры**:
```
test('TabTests', async ({ page }) => {
    const expectedTabOrder = [
      'quick-navigation-item',
      'quick-navigation-item',
      'quick-navigation-item',
      '...',
    ];
    
    for (const element of expectedTabOrder) {
      await page.keyboard.press('Tab');
      await page.waitForTimeout(500);
      await expect(page.locator(':focus')).toHaveAttribute('data-pw', `${element}`);
    };
  };
);
```
    - проверки alt`ов \
**Примеры**:
```
test('AltTests', async ({ page }) => {


    await expect (page.getByTestId(`header-logo`)).toHaveAttribute(`alt`, 'Логотип зоопарка’);

    await expect (page.getByTestId(`hero-image`)).toHaveAttribute(`alt`, 'Изображение панды’);

    await expect (page.getByTestId('footer-logo')).toHaveAttribute(`alt`, "Зоопарк работает при поддержке департамента культуры города Челябинска’);


    await expect (page.getByTestId(`cards-image`).nth(0)).toHaveAttribute('alt', 'Изображение рыбы’);

    await expect (page.getByTestId(`cards-image`) .nth(1)).toHaveAttribute('alt', 'Изображение аллигатора’);

    await expect (page.getByTestId(`cards-image`).nth(2)).toHaveAttribute(`alt`, 'Изображение медведя’);

    await expect (page.getByTestId(`cards-image`).nth(3)).toHaveAttribute(`alt`, 'Изображение быка’);
  };
);
```

    - проверки label`ов 
**Примеры**:
```
test('LabelTests', async ({ page }) => {

    await page.getByTestId('form-label-name').isVisible();
    await page.getByTestId('form-label-name').click();
    await expect(page.getByTestId('form-input-name')).toBeFocused();
    await page.screenshot({ path: 'screenshots/playwright/labels-page-screenshot.png' }); 
  };
);
```
    - проверки title`ов 
**Примеры**:
```
test('TitleTests', async ({ раде }) => {

    await expect(page.getByTestId(‘hero-abbr').nth(0)).toHaveAttribute(‘title', ‘World Wildlife Fund);
    await page.getByTitle(`Программа по Восстановлению Популяций');
    await ехресt(page.getByText('МПОЖ')).toHaveAttribute( 'title', "Международная Программа Обмена Животных’);

    await page.getByTestId(‘hero-abbr' ).nth(0).hover();
    await page.waitForTimeout(5000);
    };
);
```
    - проверки aria-label`ов
**Примеры**:

test('AriaAttrsTests', async ({ page }) => {

    await page.getByRole('textbox', { name: 'Введите ваше имя' }).isVisible();
    await page.getByRole('textbox', { name: 'Введите количество необходимых билетов' }).isVisible();
    await page.getByRole('textbox', { name: 'Введите ваш номер телефона' }).isVisible();
  };
)'

    - проверки placeholder`ов
**Примеры**: 
```
test('PlaceholderTests', async ({ page }) => { 

    await page.getByPlaceholder('Имя');
    await page.getByPlaceholder('Количество билетов').fill('10');
    await page.getByPlaceholder('Количество билетов').screenshot({ path: 'screenshots/playwright/element-screenshot.png' }); 
    await page.screenshot({ path: 'screenshots/playwright/placeholders-page-screenshot.png' });
  };
);
```

### Расположение тестов: 
Тесты располагаются по такому же принципу, как скриншотные тесты - в папке компонента.

### ANNOTATION: 
**ВСЕ ПРИМЕРЫ ВЫШЕ БЫЛИ ВЗЯТЫ ИЗ ДОКУМЕНТА АРТЕМА ШЕПТУНОВА (GitHub: @Infindery) ПО POC ТЕСТИРОВАНИЯ ДОСТУПНОСТИ.**


## Используя Axe-Core

### Axe-core - инструмент чекап критериев доступности сайта (е2е) через axe-core.

Будет достаточно слЕпо полагаться исключительно на наши собственные тесты, когда существует общепризнанный инструмент Axe-core, вдоль и поперёк анализирующий страницу на предмет нарушений критериев a11y, поэтому помимо наших тестов мы будем проводить общее сканирование страницы для перепроверки самих себя и, возможно, нахождения каких-то изъянов, которые мы сами проглядели.

Более того, проверить самим такие критерии, как, например, правильное соотношение контрастности цветов на странице - довольно проблематично, а именно это умеет в том числе Axe, так что его использоавние обусловлено не только перепроверкой себя, но и обеспечением проверок нефункциональных критериев, что не может не быть полезным.

### Расположение тестов:
- Тест (axeCheckUp.spec.tsx) лежит в ```./test/pw-tests/axe-tests/axeCheckUp.spec.tsx```

- Файл-отчет в формате .json лежит в ```./test/playwright-report/axeReport/axe-report.json``` **(записан в .gitignore)**

На данный момент в целом во время анализы всей нашей страницы проверяются альты, фокусировка элементов, ариа-лейблы, табы и контрастность цветов согласно критериям WCAG.

### Отчет Axe по выполненному анализу

После анализа страницы - в терминале вы можете наблюдать красивую таблицу с каждым критерием, не прошедшим проверку и его описанием.

Если же на нашей странице все идеально, то вы увидите подпись: 
```
No accessibility violations found.
```

### Подробная сводка всех критериев, которые на данный момент анализирует Axe на нашем сайте

## Критерии доступности и их параметры

| Критерий                     | Описание                                                                                      | Справка                                                                              | Проходит (Pass)                                                | Падает (Fail)                                                       |
|------------------------------|-----------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|---------------------------------------------------------------|--------------------------------------------------------------------|
| **color-contrast**           | Убедитесь, что контраст между цветами переднего плана и фона соответствует минимальным порогам контрастности WCAG 2 AA. | Элементы должны соответствовать минимальным порогам цветовой контрастности.       | Контраст соответствует минимальным требованиям.              | Контраст не соответствует минимальным требованиям.                 |
| **area-alt**                 | Убедитесь, что элементы `<area>` карт изображений имеют альтернативный текст.                  | Активные элементы `<area>` должны иметь альтернативный текст.                     | Все активные элементы `<area>` имеют альтернативный текст.   | Один или несколько `<area>` элементов не имеют альтернативного текста. |
| **image-alt**                | Убедитесь, что элементы `<img>` имеют альтернативный текст или что их роль не имеет значения. | Изображения должны иметь альтернативный текст.                                    | Все изображения имеют правильный `alt` текст.               | Одно или несколько изображений не имеют `alt` текста.            |
| **image-redundant-alt**      | Убедитесь, что альтернативное изображение не повторяется в виде текста.                      | Альтернативный текст изображений не должен повторяться в виде текста.             | Все альтернативные тексты уникальны и не повторяются.        | Альтернативный текст дублирует существующий текст.                |
| **input-image-alt**          | Убедитесь, что `<input type="image">` элементы имеют альтернативный текст.                   | Кнопки с изображениями должны иметь альтернативный текст.                         | Все кнопки `input` с изображениями имеют `alt` текст.       | Одно или несколько `input` элементов с изображениями не имеют `alt`.  |
| **duplicate-img-label**      | Элемент не дублирует существующий текст в `<img> alt text`.                                 | Альтернативный текст изображений должен быть уникальным.                          | Альтернативный текст уникален для каждого изображения.       | Альтернативный текст дублирует существующий текст.                 |
| **non-empty-alt**            | Элемент имеет непустой атрибут alt.                                                          | Атрибут `alt` не должен быть пустым.                                             | Атрибут `alt` заполнен.                                      | Отсутствует атрибут `alt` или он пустой.                          |
| **aria-label**               | Атрибут aria-label существует и не является пустым.                                          | Атрибут `aria-label` должен присутствовать и содержать значение.                 | Атрибут `aria-label` существует и содержит значение.        | Атрибут `aria-label` отсутствует или пустой.                       |
| **aria-labelledby**          | Атрибут aria-labelledby существует и ссылается на элементы, видимые для чтения с экрана.    | Убедитесь, что `aria-labelledby` ссылается на существующие элементы.             | `aria-labelledby` указывает на существующие элементы.        | Атрибут отсутствует или невалиден; ссылается на пустые/несуществующие элементы. |
| **color-contrast-enhanced**  | Убедитесь, что контраст между цветами переднего плана и фона соответствует пороговым значениям повышенной контрастности WCAG 2 AAA. | Элементы должны соответствовать пороговым значениям повышенной цветовой контрастности. | Контраст соответствует требованиям WCAG 2 AAA.              | Контраст не соответствует требованиям WCAG 2 AAA.                  |
| **focusable-no-name**        | Элемент расположен не в порядке табуляции или имеет доступный текст.                         | Элементы должны быть доступны для навигации с клавиатуры и иметь текст.          | Элемент can be focused или доступен через табуляцию.         | Элемент не может быть сфокусирован и не имеет доступного текста.   |
| **focusable-content**        | Элемент содержит фокусируемые элементы.                                                      | Элементы должны иметь возможность быть сфокусированными.                         | Элемент содержит фокусируемые элементы.                       | Элемент не имеет фокусируемого содержимого.                        |
| **focusable-element**        | Элемент можно сфокусировать.                                                                 | Элементы должны быть интерактивными и поддерживать фокус.                        | Элемент можно сфокусировать.                                  | Элемент не может быть сфокусирован.                                |





