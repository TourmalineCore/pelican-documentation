# Лоадер

#### Статус
Принято

## Контекст
При первоначальной загрузке сайта и при переходе между страницами показывался белый экран или сайт зависал. Чтобы избежать этого, мы решили добавить лоадер.

## Решение
Мы реализовали кастомный загрузчик (лоадер). Лоадер представляет собой анимированное кольцо из 8 SVG-иконок, которые поочерёдно появляются и исчезают, создавая эффект шагов по кругу.

![loader](./gif/loader.gif)

Он встроен в интерфейс для 2 случаев:
- через компонент RouteChangeLoader, в котором рендерится LoaderContent **при навигации между страницами**

- через файл _document.ts, в котором **при первоначальной подгрузке страницы** рендерится только LoaderContent для моментального отображения лоадера без ожидания подгрузки стилевых и др. файлов

### Основные компоненты:

#### Компонент RouteChangeLoader:

1. Следит за маршрутом через next/router, чтобы отследить начало события для активации лоадера

2. Активирует лоадер с небольшой задержкой (300 мс), чтобы избежать мелькания при быстрых переходах

3. Показывает LoaderContent, если маршрут меняется

#### Компонент LoaderContent:

1. Рендерит 8 одинаковых блоков с svg, каждый в своём `<div className="loader">`.

2. Для каждого из 8 div`ов добавляется индивидуальный inline-стиль с:

- animation-delay: задержка появления

- transform: rotate(...) translateY(...) rotate(...): поворот на свой угол по кругу

#### CSS-анимация:

1. Объявлена анимация `@keyframes pawStep`, в которой иконка постепенно появляется (opacity 1) и исчезает

2. Каждый из 8 div`ов получает:

- уникальный animation-delay, чтобы появляться с интервалами

- transform, чтобы расположиться на окружности и быть повернутым

### Как работает отрисовка:
Генерация 8 иконок:
```js
Array.from({ length: 8 }).map((_, i) => (
  <div className="loader" key={i}>
    <svg>...</svg>
  </div>
))
```

Для каждой иконки:
```js
const styles = Array.from({ length: 8 })
  .map((_, i) => `
    .loader:nth-of-type(${i + 1}) {
      animation-delay: ${i * 0.25}s;
      transform: rotate(${i * 45}deg) translateY(-50px) rotate(${i + 140}deg);
    }
  `)
```

Расшифровка:  
- rotate(${i * 45}deg) — поворачивает иконку вокруг центра контейнера (располагает по кругу)

- translateY(-50px) — сдвигает её наружу от центра (радиус круга)

- rotate(${i + 140}deg) — дополнительный поворот, чтобы иконка "смотрела наружу"

- animation-delay — задержка появления иконки, чтобы они появлялись по очереди

Пример:  
- i = 0: иконка будет наверху

- i = 1: на 45° вправо

- i = 2: 90° и т.д. — по часовой стрелке


## Альтернативы

### 1. Использовать CSS only спиннер (без SVG и JS)

### 2. Использовать готовую библиотеку с лоадерами

#### Плюсы к 1 и 2:
Простота реализации и кода.

#### Минусы к 1 и 2:
- Меньше визуальной индивидуальности

- Труднее стилизовать под бренд

### 3. Показывать skeletons вместо глобального лоадера

#### Плюсы:
Блоки не скачут при загрузке и сразу понятна структура страницы.

#### Минусы:
Сложность реализации.

## Последствия
- Такой лоадер можно адаптировать под любую SVG-графику

- Работает с CSP (Content Security Policy), так как использует nonce для inline-стилей

### Плюсы:
- Появился лоадер с интересной анимацией

- Полностью кастомный: SVG можно заменить

- Работает при жёсткой политике CSP (благодаря nonce)

### Минусы:
- Сложнее, чем стандартный спиннер

- Зависит от точного расчета углов и смещений
