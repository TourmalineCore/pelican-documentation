# Процесс верстки через TDD

## Статус
Предложенный

## Контекст
Необходимо тестировать компоненты в изоляции, но поскольку с компонентными тестами возникли сложности, используем обходной вариант тестировать через е2е, но обращаться к компоненту на отдельной странице, где он также будет в изоляции.

Добавлять тестируемые компоненты необходимо [cюда](https://github.com/TourmalineCore/pelican-ui/blob/master/src/pages/components/%5B%5B...component%5D%5D.tsx)

## Решение
1. Создаем е2е тест в папке компонента (например, ```src/components/home-page/Hero/Hero.spec.tsx```), в котором идем на страницу, где отрисован целевой компонент.
2. Задаем брейкпойнты - ширину (по умолчанию она соответствует MOBILE брейкпойнту). 
3. Запускаем тест. При первом прогоне создастся папка для скриншотов (```playwright-tests\screenshots\base\src\components```), в которую генерируются снимки текущего состояния компонента.
Чтобы Playwright мог найти компонент, мы используем атрибут **data-testid** на компоненте. Если еще не существует тега с data-testid, то Playwright ничего не сможет найти, и не создаст папку.
4. Экспортируем изображения в формате png из фигмы, заменяем ими изображения в папке для скриншотов. Важно чтобы название файлов были, точно такими же, как playwright генерирует сам.
5. Верстаем компонент, сверяясь с эталонным изображением (пользуясь инструментами в UI Playwright-a: difference, actual, expected, side by side, slider)
6. При достижении максимально приемлемого сходства заменяем эталонные изображения из фигмы на снимки актуального текущего состояния компонента. Для этого можно очистить папку, где лежат png из фигмы и вновь прогнать тест, также можно запустить команду ```npx playwright test --update-snapshots```, которая прогоняет все тесты и обновляет несовпадающие изображения.

### Примечания
1. Необходимо работать над проектом через devcontainer, чтобы эталонные снимки были идентичны тем, что в пайплайне, независимо от вашей операционной системы.
2. Определенное именования файлов для картинок из фигмы. <br/>
	Пример:<br/>
		**header-desktop-chromium-linux**<br/>
		**header-desktop-firefox-linux**
