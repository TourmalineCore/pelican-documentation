# Флоу работы с pixel-perfect тестами

## Статус
Предложенный

## Контекст
Необходимо тестировать компоненты в изоляции, но поскольку с компонентными тестами возникли сложности, используем обходной вариант тестировать через е2е, но обращаться к компоненту.

## Решение
1. Создаем е2е тест в папке компонента (например, ```src/components/home-page/Hero/Hero.spec.tsx```), в котором идем на страницу, где отрисован целевой компонент.
2. Задаем брейкпойнты - ширину (по умолчанию она соответствует MOBILE брейкпойнту) и высоту (замеряем в фигме). 
3. Запускаем тест. При первом прогоне создастся папка для скриншотов (```/test/pw-tests/screenshots/e2e-tests/base```), в которую генерируются снимки текущего состояния компонента.
Чтобы Playwright мог найти компонент, мы используем атрибут **data-testid** на компоненте. Если еще не существует тега с data-testid, то Playwright ничего не сможет найти, и не создаст папку.
4. Экспортируем изображения в формате png из фигмы, заменяем ими изображения в папке для скриншотов.
5. Верстаем компонент, сверяясь с эталонным изображением (пользуясь инструментами в UI Playwright-a: difference, actual, expected, side by side, slider)
6. При достижении максимально приемлемого сходства заменяем эталонные изображения из фигмы на снимки актуального текущего состояния компонента. Для этого можно очистить папку, где лежат png из фигмы и вновь прогнать тест, либо просто запустить команду ```npx playwright test --update-snapshots```.

### Примечания
1. Необходимо работать над проектом через devcontainer, чтобы эталонные снимки были идентичны тем, что в пайплайне, независимо от вашей операционной системы.
2. Определенное именования файлов для картинок из фигмы. <br/>
	Пример:<br/>
		**header-desktop-chromium-linux**<br/>
		**header-desktop-firefox-linux**
