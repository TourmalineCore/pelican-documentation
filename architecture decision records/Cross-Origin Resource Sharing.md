# Cross-Origin Resource Sharing

## Статус
Принято

## Контекст
CORS (Cross-Origin Resource Sharing) — это механизм в браузере, который регулирует, может ли один веб-сайт (домен) делать запросы к ресурсам на другом сайте (домене). Он нужен, чтобы защитить пользователей от потенциально опасных действий, когда один сайт (возможно, вредоносный) пытается взаимодействовать с другим сайтом.

## Решение
Для повышения безопасности и предсказуемости поведения сайта мы приняли решение настроить заголовки, связанные с CORS и безопасностью, через метод headers() в next.config.js.

Были добавлены такие заголовки:

1. CORS-заголовки

- **Access-Control-Allow-Credentials: false** - Запрещает браузеру передавать cookies и другие credentials в кросс-доменных запросах. Это снижает риск утечек сессионной информации при внешнем доступе к сайту.

- **Access-Control-Allow-Origin: https://chelzoo.tech** - Ограничивает доступ только для Origin: https://chelzoo.tech, что на практике означает запрет на кросс-доменные запросы с большинства сайтов.

- **Cross-Origin-Opener-Policy: same-origin** - Изолирует контексты между окнами и вкладками с разными origin-ами, защищая от атак.

2. Заголовки безопасности

- **X-Frame-Options: SAMEORIGIN** - Запрещает отображение сайта внутри `<iframe>` с другого origin-а, тем самым защищает от clickjacking-атак.

- **X-Content-Type-Options: nosniff** - Браузеру запрещено пытаться угадать тип содержимого, если заголовок Content-Type не соответствует. Это предотвращает возможное выполнение вредоносного кода, ошибочно интерпретированного браузером.

- **Referrer-Policy: no-referrer** - Полностью отключает отправку заголовка Referer, обеспечивая максимальную приватность пользователя и предотвращая утечку URL-ов с чувствительной информацией.

- **Permissions-Policy: interest-cohort=(), camera=(), microphone=(), geolocation=(), fullscreen=(), payment=(), usb=(), accelerometer=(), display-capture=(), gyroscope=(), magnetometer=(), midi=(), picture-in-picture=(self), xr-spatial-tracking=()** - Ограничивает или полностью запрещает доступ к множеству встроенных API браузера:
    - interest-cohort=() запрещает Google FLoC (Federated Learning of Cohorts).
    - Отключены: камера, микрофон, геолокация, USB, акселерометр, захват экрана и т.п.
    - Разрешён только picture-in-picture с того же origin-а (self), что позволяет использовать встроенное видео в плавающем режиме.

Эти заголовки помогают усилить безопасность приложения, ограничить внешнее вмешательство, минимизировать риски утечки данных и дать разработчику полный контроль над политикой доступа.

## Альтернативы
Не рассматривали.

## Последствия
Ограниченный доступ с других origin-ов делает приложение более безопасным по умолчанию.

## Плюсы
- Повышенная безопасность (защита от clickjacking, MIME-sniffing, side-channel атак и утечек через referer).

- Полный контроль над политикой доступа и изоляцией.

- Снижение рисков, связанных с кросс-доменными запросами.

## Минусы
Могут возникнуть проблемы с совместимостью для пользователей, использующих старые браузеры, которые не поддерживают некоторые заголовки.

### Ссылка на PR
https://github.com/TourmalineCore/pelican-ui/pull/303
